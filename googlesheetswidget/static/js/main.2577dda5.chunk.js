(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(e,t,n){},104:function(e,t,n){},269:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),s=n(13),i=n.n(s),c=(n(103),n(8)),l=n(9),r=n(12),u=n(10),d=n(2),h=n(11),m=(n(104),n(271)),p=n(33),g=n.n(p),f=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(r.a)(this,Object(u.a)(t).call(this,e))).state={},n.handleAuthClick=n.handleAuthClick.bind(Object(d.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"handleAuthClick",value:function(e){console.log("handle auth click"),window.gapi.auth2.getAuthInstance().grantOfflineAccess().then(function(t){var n=t.code;g.a.ajax({url:"https://g6728mnsi5.execute-api.us-east-1.amazonaws.com/exchangeCodeForTOken/exchangecodefortoken",method:"POST",data:n,success:function(t){console.log("Done!"),e.props.authDone(),console.log(t)},error:function(e){console.log("BOO"),console.log(e)}})})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col align-self-center"},o.a.createElement("div",{className:"buttons"},o.a.createElement(m.a,{id:"button",onClick:function(){return e.handleAuthClick(e)}},"Authorise")))))}}]),t}(a.Component),b=n(97),v=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(r.a)(this,Object(u.a)(t).call(this,e))).state={multiple:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=(!1).multiple;return o.a.createElement(b.Typeahead,{labelKey:"name",multiple:t,options:this.props.options,placeholder:"Search",onChange:function(t){console.log(t),e.props.options.includes(t)&&(console.log("Includes"),window.JFCustomWidget.sendData({value:t}))}})}}]),t}(a.Component),w=function(e){function t(){return Object(c.a)(this,t),Object(r.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col align-self-center"},o.a.createElement("h2",null,"Loading..."))))}}]),t}(a.Component),O=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(r.a)(this,Object(u.a)(t).call(this,e))).state={input:"",failedLookup:!1,options:[],updated:!1},n.fetchGoogleSheets=n.fetchGoogleSheets.bind(Object(d.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.fetchGoogleSheets(this),window.JFCustomWidget.subscribe("submit",function(e){var t={valid:!0,value:document.getElementsByTagName("input")[0].value};window.JFCustomWidget.sendSubmit(t)})}},{key:"fetchGoogleSheets",value:function(e){console.log("In fetch google sheets"),g.a.ajax({url:"https://g6728mnsi5.execute-api.us-east-1.amazonaws.com/exchangeCodeForTOken/querygooglesheet",method:"POST",data:JSON.stringify({sheetId:e.props.spreadsheetUrl,table:e.props.googleSheetTable}),success:function(t){for(var n=[],a=0;a<t.values.length;a++)t.values[a][e.props.columnIndex]&&n.push(t.values[a][e.props.columnIndex]);e.setState({options:n,updated:!0})},error:function(t){console.log(t),e.setState({failedLookup:!0})}})}},{key:"render",value:function(){return this.state.failedLookup?o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col align-self-center"},o.a.createElement("h2",null,"There was an error loading data from google sheets..."),o.a.createElement("h4",null,"Ensure that google sheets id,table name and column id are correct and reload the page. ")))):this.state.updated?o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"col-sm-10"},o.a.createElement(v,{options:this.state.options,columnIndex:0}," "))):o.a.createElement(w,null," ")}}]),t}(a.Component),j=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(r.a)(this,Object(u.a)(t).call(this,e))).state={loading:!0,status:"auth",spreadsheetUrl:"",googleSheetTable:"",columnIndex:0},n.authDone=n.authDone.bind(Object(d.a)(n)),n.initClient=n.initClient.bind(Object(d.a)(n)),n.loadGapiAndAfterwardsInitAuth=n.loadGapiAndAfterwardsInitAuth.bind(Object(d.a)(n)),n.getJotFormParams=n.getJotFormParams.bind(Object(d.a)(n)),n.loadAWS=n.loadAWS.bind(Object(d.a)(n)),n.prepAWS=n.prepAWS.bind(Object(d.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"loadGapiAndAfterwardsInitAuth",value:function(){var e=this,t=document.createElement("script");t.src="https://apis.google.com/js/api.js",t.async=!0,t.defer=!0,t.onload=function(){e.initClient(e)},document.head.appendChild(t)}},{key:"loadAWS",value:function(){var e=this,t=document.createElement("script");t.src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js",t.async=!0,t.defer=!0,t.onload=function(){e.prepAWS(e)},document.head.appendChild(t)}},{key:"prepAWS",value:function(e){console.log("AWS ready!");var t="kuku.bucket.for.creds.superunique1235925";window.AWS.config.region="us-east-1",window.AWS.config.credentials=new window.AWS.CognitoIdentityCredentials({IdentityPoolId:"us-east-1:ae3448c6-787e-4d5c-8e3b-19b9acba2b38"}),new window.AWS.S3({apiVersion:"2006-03-01",params:{Bucket:t}}).getObject({Bucket:t,Key:"Done.txt"},function(t,n){t?e.loadGapiAndAfterwardsInitAuth():e.setState({status:"search",loading:!1})})}},{key:"componentDidMount",value:function(){var e=this;this.loadAWS(),window.JFCustomWidget.subscribe("ready",function(){e.getJotFormParams(e)})}},{key:"getJotFormParams",value:function(e){var t=window.JFCustomWidget.getWidgetSetting("googleSheetId"),n=window.JFCustomWidget.getWidgetSetting("googleSheetTableName"),a=window.JFCustomWidget.getWidgetSetting("columnIndex");e.setState({spreadsheetUrl:t,googleSheetTable:n,columnIndex:a-1})}},{key:"authDone",value:function(){this.setState({status:"search"})}},{key:"initClient",value:function(e){var t=["https://sheets.googleapis.com/$discovery/rest?version=v4"];window.gapi.load("client",function(){window.gapi.client.init({apiKey:"AIzaSyDjHBwz8TITrxzmbOhLgx0m0MW1RyXkAPw",clientId:"359652543273-isuh9t7hco6p8f1pav3kau3misrim8tv.apps.googleusercontent.com",discoveryDocs:t,scope:"https://www.googleapis.com/auth/spreadsheets.readonly"}).then(function(t){e.setState({loading:!1}),console.log("client loaded")}).catch(function(e){console.log(e)})})}},{key:"render",value:function(){var e;return this.state.loading||!this.state.spreadsheetUrl?e=o.a.createElement(w,null," "):"auth"===this.state.status?e=o.a.createElement(f,{authDone:this.authDone}," "):"search"===this.state.status&&(e=o.a.createElement(O,{spreadsheetUrl:this.state.spreadsheetUrl,googleSheetTable:this.state.googleSheetTable,columnIndex:this.state.columnIndex})),o.a.createElement("div",{className:"App"},e)}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(267),n(268);i.a.render(o.a.createElement(j,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},98:function(e,t,n){e.exports=n(269)}},[[98,1,2]]]);
//# sourceMappingURL=main.2577dda5.chunk.js.map